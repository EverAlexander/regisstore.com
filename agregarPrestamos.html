<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agregar Préstamo</title>
<script src="https://apis.google.com/js/api.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
form { max-width: 600px; margin: auto; }
label { display: block; margin-top: 10px; }
input { width: 100%; padding: 8px; margin-top: 4px; }
button { margin-top: 20px; padding: 10px 20px; }
#mensaje { text-align: center; margin-top: 20px; color: green; }
</style>
</head>
<body>

<h1>Agregar Préstamo</h1>

<form id="formAgregar">
  <label>Nombre completo: <input type="text" name="nombre" required></label>
  <label>Documento: <input type="text" name="documento" required></label>
  <label>Fecha: <input type="date" name="fecha"></label>
  <button type="submit">Agregar</button>
</form>

<div id="mensaje"></div>

<script>
const CLIENT_ID = '257644747195-10it3ejvfcj6i7pifc5vqjp8r3bjptu6.apps.googleusercontent.com';
const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
const SPREADSHEET_ID = '1jcP5Kwh903YSN4sXV4CCC6EAUOwxM1rTmk339Evlh-I';
const RANGE = 'prestamosnivel6!A1:Z1000';

function gapiLoaded() {
  gapi.load('client:auth2', initClient);
}

async function initClient() {
  await gapi.client.init({
    clientId: CLIENT_ID,
    scope: SCOPES,
    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
  });
}

async function signIn() {
  const GoogleAuth = gapi.auth2.getAuthInstance();
  if (!GoogleAuth.isSignedIn.get()) {
    await GoogleAuth.signIn();
  }
}

document.getElementById('formAgregar').addEventListener('submit', async (e) => {
  e.preventDefault();
  const datos = Array.from(e.target.elements)
                     .filter(el => el.tagName === "INPUT")
                     .map(el => el.value);

  try {
    await signIn(); // Solicitar autorización al usuario
    await gapi.client.sheets.spreadsheets.values.append({
      spreadsheetId: SPREADSHEET_ID,
      range: RANGE,
      valueInputOption: 'RAW',
      insertDataOption: 'INSERT_ROWS',
      resource: { values: [datos] }
    });
    document.getElementById('mensaje').textContent = '✅ Registro agregado correctamente';
    e.target.reset();
  } catch (err) {
    console.error(err);
    document.getElementById('mensaje').textContent = '❌ Error al agregar registro';
  }
});

gapiLoaded();
</script>

</body>
</html>
